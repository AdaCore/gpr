--
--  Copyright (C) 2024, AdaCore
--
--  SPDX-License-Identifier: Apache-2.0 WITH LLVM-Exception
--

with GPR2.Build.Compilation_Unit;
with GPR2.Project.Registry.Attribute;

with GNATCOLL.OS.Process;

package GPR2.Build.Actions.Ada_Compile.Post_Bind is

   package PRA renames GPR2.Project.Registry.Attribute;

   type Object is new Actions.Ada_Compile.Object with private;
   --  Action responsible for building Ada sources generated by gnatbind

   Undefined : constant Object;

   overriding procedure Initialize
     (Self : in out Object; Src : GPR2.Build.Compilation_Unit.Object);

   overriding function Input_Unit
     (Self : Object) return GPR2.Build.Compilation_Unit.Object;

   overriding procedure On_Tree_Insertion
     (Self     : Object;
      Db       : in out GPR2.Build.Tree_Db.Object;
      Messages : in out GPR2.Log.Object);

   overriding procedure Compute_Signature (Self : in out Object);

   overriding procedure Compute_Command
     (Self : in out Object;
      Args : out GNATCOLL.OS.Process.Argument_List;
      Env  : out GNATCOLL.OS.Process.Environment_Dict);

private

   type Object is new Actions.Ada_Compile.Object with record
         Unit : GPR2.Build.Compilation_Unit.Object;
      --  Unit needs to be stored explicitly as it is not contained
      --  by any view. It can not be found with a UID.Ctxt.Unit (...).
   end record;

   overriding function Is_Defined (Self : Object) return Boolean is
     (Self /= Undefined);

   overriding function Input_Unit
     (Self : Object) return GPR2.Build.Compilation_Unit.Object
   is (Self.Unit);

   Undefined : constant Object := (others => <>);

end GPR2.Build.Actions.Ada_Compile.Post_Bind;
